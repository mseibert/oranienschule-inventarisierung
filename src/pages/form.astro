---
import Layout from '../layouts/Layout.astro';
---

<Layout>
<div class="max-w-md mx-auto p-8 bg-white rounded-xl shadow-lg">
  <h1 class="text-3xl font-bold mb-8 text-gray-800 text-center">Kontaktiere uns</h1>
  <form id="registerForm" class="space-y-6">

    <div class="space-y-2">
      <label class="block text-lg font-medium text-gray-700">
        Nachricht:
        <textarea 
          name="message" 
          required 
          rows="4"
          class="mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-lg p-3"
        ></textarea>
      </label>
    </div>

	<div class="space-y-2">
		<label class="block text-lg font-medium text-gray-700">
		  Email:
		  <input 
			type="email" 
			name="email" 
			required 
			class="mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-lg p-3"
		  />
		</label>
	  </div>

    <p id="errorMessage" class="text-red-500 text-sm mt-1 hidden"></p>

    <button 
      type="submit"
      class="w-full bg-orange-500 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors mt-8"
      id="submitButton"
    >
      Register
    </button>
  </form>
</div>

<script>
  const form = document.getElementById('registerForm');
  const submitButton = document.getElementById('submitButton') as HTMLButtonElement;
  const errorMessage = document.getElementById('errorMessage');
  const emailInput = document.querySelector('input[name=email]') as HTMLInputElement;
  const messageInput = document.querySelector('textarea[name=message]') as HTMLTextAreaElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!emailInput || !submitButton || !errorMessage) return;
    
    try {
      submitButton.disabled = true;
      submitButton.textContent = 'Sending...';
      errorMessage.classList.add('hidden');
      
      const response = await fetch('https://n8n.apps.seibert-media.net/webhook/4a63a36e-ce50-46c5-a543-743f52e30159', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: emailInput.value,
          message: messageInput.value
        })
      });

      const result = await response.json();
      
      if (response.ok) {
        alert('Registration successful!');
        emailInput.value = '';
        messageInput.value = '';
      } else {
        errorMessage.textContent = result.error || 'Registration failed. Please try again.';
        errorMessage.classList.remove('hidden');
      }
    } catch (error) {
      console.error('Error submitting form:', error);
      errorMessage.textContent = 'An error occurred while submitting the form. Please try again.';
      errorMessage.classList.remove('hidden');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Register';
    }
  });
</script>
</Layout>