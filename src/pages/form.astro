---
export const prerender = false; // Not needed in 'server' mode

// import { isRegistered, registerUser } from "../data/users"
// import { isValidEmail } from "../utils/isValidEmail";
import Layout from '../layouts/Layout.astro';

const errors = { email: "" };
if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const email = data.get("email");
    if (typeof email !== "string" || email.length < 1) {
      errors.email += "Please enter an email. ";
    }
    const hasErrors = Object.values(errors).some(msg => msg)
    if (!hasErrors) {
      // await registerUser({name, email, password});
      const emailInput = document.querySelector('input[name=email]') as HTMLInputElement;
      console.log('Form submitted:', {
        email: emailInput?.value || ''
      });
    }
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---
<Layout>
<div class="max-w-md mx-auto p-8 bg-white rounded-xl shadow-lg">
  <h1 class="text-3xl font-bold mb-8 text-gray-800 text-center">Register</h1>
  <form method="POST" class="space-y-6">
    <div class="space-y-2">
      <label class="block text-lg font-medium text-gray-700">
        Email:
        <input 
          type="email" 
          name="email" 
          required 
          class="mt-2 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-lg p-3"
        />
      </label>
      {errors.email && <p class="text-red-500 text-sm mt-1">{errors.email}</p>}
    </div>

    <button 
      type="submit"
      class="w-full bg-orange-500 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors mt-8"
      id="submitButton"
    >
      Register
    </button>
  </form>
</div>

<script>
  document.getElementById('submitButton')?.addEventListener('click', async (e) => {
    e.preventDefault();
    const emailInput = document.querySelector('input[name=email]') as HTMLInputElement;
    const submitButton = document.getElementById('submitButton') as HTMLButtonElement;
    
    try {
      submitButton.disabled = true;
      submitButton.textContent = 'Sending...';
      
      const response = await fetch('/api/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: emailInput?.value || ''
        })
      });

      const result = await response.json();
      
      if (response.ok) {
        alert('Registration successful!');
        emailInput.value = '';
      } else {
        alert('Registration failed: ' + (result.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Error submitting form:', error);
      alert('An error occurred while submitting the form. Please try again.');
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = 'Register';
    }
  });
</script>
</Layout>